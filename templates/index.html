<!DOCTYPE html>
<html>
<head>
    <title>Professional Counter</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Counter</h1>
        <div class="count">{{.}}</div>
        <div class="buttons">
            <form method="POST" action="/"><button type="submit" name="action" value="increment" class="increment">Increment</button></form>
            <form method="POST" action="/"><button type="submit" name="action" value="reset" class="reset">Reset</button></form>
        </div>
    </div>

    <!-- Audio elements for the sounds -->
    <audio id="increment-sound" src="/static/increment.mp3" preload="auto"></audio>
    <audio id="reset-sound" src="/static/reset.mp3" preload="auto"></audio>

    <script>
        // Wait for the document to be fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Find the forms for our buttons
            const incrementForm = document.querySelector('button[value="increment"]').closest('form');
            const resetForm = document.querySelector('button[value="reset"]').closest('form');

            // Find the audio elements
            const incrementSound = document.getElementById('increment-sound');
            const resetSound = document.getElementById('reset-sound');

            // Handle the increment button with a simple delay for responsiveness.
            incrementForm.addEventListener('submit', (event) => {
                event.preventDefault();
                incrementSound.currentTime = 0;
                incrementSound.play();
                
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'action';
                hiddenInput.value = 'increment';
                event.target.appendChild(hiddenInput);

                setTimeout(() => { event.target.submit(); }, 300);
            });

            // Handle the reset button click.
            resetForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const form = event.target;

                // Visually reset the counter on the client-side immediately for instant feedback.
                document.querySelector('.count').innerText = '0';

                // Disable the increment button to prevent race conditions.
                document.querySelector('button[value="increment"]').disabled = true;

                // Create a hidden input to send the 'reset' action to the server.
                // We remove any old one first to prevent duplicates on rapid clicks.
                form.querySelector('input[name="action"]')?.remove();
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'action';
                hiddenInput.value = 'reset';
                form.appendChild(hiddenInput);

                // Submit the form ONLY when the sound has finished playing.
                resetSound.addEventListener('ended', () => form.submit(), { once: true });

                resetSound.currentTime = 0;
                resetSound.play();
            });
        });
    </script>
</body>
</html>